{% extends "base_user.html" %}
{% block title %}Profile | StudyTrackr{% endblock %}
{% block subtitle %}Profile{% endblock %}
{% block tooltip %}
<div class="absolute top-full left-0 mt-2 w-72 bg-white/90 p-4 rounded-xl shadow-2xl text-sm text-gray-800 hidden group-hover:block z-20 border border-gray-100">
    Manage your profile settings, add friends, and view your account information.
</div>
{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">

<div class="min-h-screen py-10 px-2">
  <div class="max-w-3xl mx-auto space-y-10">

    <!-- Profile Card -->
    <div class="bg-white/90 rounded-3xl shadow-2xl p-10 flex flex-col items-center relative border border-gray-100">
      <div class="w-28 h-28 rounded-full bg-gradient-to-tr from-purple-500 to-indigo-600 flex items-center justify-center text-5xl text-white font-extrabold mb-5 shadow-lg ring-4 ring-indigo-100">
        {{ current_user.email[0]|upper }}
      </div>
      <h2 class="text-3xl font-bold mb-1 tracking-tight text-gray-900">{{ current_user.email }}</h2>
      <p class="text-gray-500 mb-2 text-sm">
        Joined
        {% if current_user.created_at %}
          {{ current_user.created_at.strftime('%B %d, %Y') }}
        {% else %}
          Unknown
        {% endif %}
      </p>
    </div>

    <!-- Add Friend Form -->
    <div class="bg-white/90 rounded-2xl shadow-xl p-8 border border-gray-100">
      <h3 class="text-lg font-semibold mb-4 text-indigo-700 flex items-center gap-2">
        <i class="lucide" data-lucide="user-plus"></i> Add a Friend
      </h3>
      <form action="{{ url_for('logged_in.profile') }}" method="POST" class="friend-form-ui flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch w-full">
        {{ form.hidden_tag() }}
        <div class="flex-1 w-full">
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">{{ form.email.label }}</label>
          <input type="email" name="email" id="email" class="form-input w-full rounded-lg border border-gray-200 focus:ring-2 focus:ring-indigo-400 px-4 py-3 transition text-base" placeholder="Enter friend's email" autocomplete="off">
          {% if form.email.errors %}
            <div class="error-message text-red-500 text-xs mt-1">
              {% for error in form.email.errors %}
                <p>{{ error }}</p>
              {% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="flex items-end w-full sm:w-auto">
          <button type="submit" class="submit-button add-friend-btn bg-gradient-to-tr from-indigo-500 to-purple-500 text-white font-semibold px-6 py-3 rounded-lg shadow hover:scale-105 transition w-full sm:w-auto h-full text-base">
            Add Friend
          </button>
        </div>
      </form>
    </div>

    <script src="{{ url_for('static', filename='js/autocomplete_emails.js') }}"></script>

    <!-- Friends List Section -->
    <div class="bg-white/90 rounded-3xl shadow-2xl p-8 border border-gray-100">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-gray-900">Your Friends</h3>
        <!-- Modal trigger could be added here if needed -->
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        {% for friend in current_user.friends.all() %}
        <div class="flex items-center bg-gradient-to-tr from-indigo-100/80 to-purple-100/80 rounded-xl p-4 shadow hover:shadow-lg transition group border border-gray-100">
          <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-indigo-400 to-purple-500 flex items-center justify-center text-2xl text-white font-bold mr-4 shadow ring-2 ring-indigo-200 group-hover:scale-105 transition">
            {{ friend.email[0]|upper }}
          </div>
          <span class="flex-1 text-gray-800 font-medium truncate">{{ friend.email }}</span>
          <form action="{{ url_for('logged_in.logged_in_remove_friend', friend_id=friend.id) }}" method="POST" class="ml-2">
            {{ form.hidden_tag() }}
            <button type="submit" class="ml-2 text-red-500 hover:text-red-700 rounded-full p-2 transition" title="Remove Friend">
              <i class="lucide" data-lucide="user-minus"></i>
            </button>
          </form>
        </div>
        {% else %}
        <p class="text-gray-400 col-span-full text-center py-6">You have no friends yet.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}